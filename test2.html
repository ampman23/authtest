<html>
	<head>
		<script type="text/javascript" src="https://jstest.authorize.net/v1/Accept.js" charset="utf-8"></script>
	</head>
	<body>
	
		<form>
			<button type="submit" onclick="sendPaymentDataToAnet();return false;">Pay</button>
		</form>
		
		<script>
			function sendPaymentDataToAnet() {
	var secureData = {}, authData = {}, cardData = {};
	
	cardData.cardNumber = "5424000000000015";//document.getElementById('CARDNUMBER_ID').value;
	cardData.month = "12";//document.getElementById('EXPIRY_MONTH_ID').value;
	cardData.year = "18";//document.getElementById('EXPIRY_YEAR_ID').value;
	secureData.cardData = cardData;

	authData.clientKey = '8eT7NRm69ugUgG39R33jP3r9fY3UE3KH7jnyA7mkVtTq4gr8A9J8kjbL5GjSjXcz';
	authData.apiLoginID = '3KKAue4S32fk';
	secureData.authData = authData;
	console.log ("1");
	Accept.dispatchData(secureData, 'responseHandler');
			}

function responseHandler(response) {
	console.log ("2");
    if (response.messages.resultCode === 'Error') {
	    console.log ("3");
        for (var i = 0; i < response.messages.message.length; i++) {
		console.log ("4" + i);
            console.log(response.messages.message[i].code + ':' + response.messages.message[i].text);
        }
    } else {
	    console.log ("5");
        useOpaqueData(response.opaqueData)
    }
}

function useOpaqueData(responseData) {
	console.log ("6");
    // This is where you would set the data descriptor & data value to be posted back to your server
    console.log(responseData.dataDescriptor);
    console.log(responseData.dataValue);
    //alert(responseData.dataValue);
	confirmPayment(responseData.dataValue);
}
		
			function confirmPayment(nonce) {
				console.log ("7");
	var secureData = {transactionType:"authCaptureTransaction",amount:"75",dataDescriptor:"COMMON.ACCEPT.INAPP.PAYMENT",dataValue:nonce};
				console.log ("7a");
	/*
	secureData.amount = '75';
				console.log ("7b");
	secureData.dataDescriptor = 'COMMON.ACCEPT.INAPP.PAYMENT';
				console.log ("7c");
	secureData.dataValue = nonce;
				console.log ("7d");
	*/
	console.log ("8" + secureData.transactionType + secureData.amount + secureData.dataDescriptor + secureData.dataValue);
	Accept.dispatchData(secureData, 'responsePaymentHandler');
}

function responsePaymentHandler(response) {
	console.log ("9");
    if (response.messages.resultCode === 'Error') {
	    console.log ("10");
        for (var i = 0; i < response.messages.message.length; i++) {
		console.log ("4" + i);
            console.log(response.messages.message[i].code + ':' + response.messages.message[i].text);
        }
    } else {
	    console.log ("11 complete");
        
    }
}
		</script>

	</body>
</html>
